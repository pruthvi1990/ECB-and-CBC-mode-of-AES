/* Driver Function to test the AES 128 bit CBC (Cipher Block Chaining)
   and ECB (Electronic Code Block). 
*/

#include <stdio.h>
#include <string.h>
#include "encrypt.c"

void encrypt_ECB(void);
void decrypt_ECB(void);
void encrypt_CBC(void);
void decrypt_CBC(void);

int main()
{

	encrypt_ECB();
	decrypt_ECB();
	encrypt_CBC();
	decrypt_CBC();

}


void encrypt_ECB(void){
	
	uint8_t key[] = {0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c};
  	uint8_t data_block[]  = {0x6b, 0xc1, 0xbe, 0xe2, 0x2e, 0x40, 0x9f, 0x96, 0xe9, 0x3d, 0x7e, 0x11, 0x73, 0x93, 0x17, 0x2a};
	uint8_t expected_op[]  = {0x3a, 0xd7, 0x7b, 0xb4, 0x0d, 0x7a, 0x36, 0x60, 0xa8, 0x9e, 0xca, 0xf3, 0x24, 0x66, 0xef, 0x97};
	uint8_t buf[16];
	memset(buf,0,16);
	AES_128bit_encryption(data_block,buf,key);
	if (!(strncmp(expected_op,buf,16))){
		
		printf("\n###########Encryption Successful ##############\n\n");
	}
	else
		printf("\n###########Encryption Failed ##############\n\n");
}

void decrypt_ECB(void){
	
	uint8_t key[] = {0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c};
	uint8_t decrypt_data [] ={0x3a, 0xd7, 0x7b, 0xb4, 0x0d, 0x7a, 0x36, 0x60, 0xa8, 0x9e, 0xca, 0xf3, 0x24, 0x66, 0xef, 0x97};
	uint8_t expected_op[]  = {0x6b, 0xc1, 0xbe, 0xe2, 0x2e, 0x40, 0x9f, 0x96, 0xe9, 0x3d, 0x7e, 0x11, 0x73, 0x93, 0x17, 0x2a};
	uint8_t buf_out[16];
	memset(buf_out,0,16);
	AES_128bit_decrytption(decrypt_data,buf_out,key);
	
	if (!(strncmp(expected_op,buf_out,16))){
		
		printf("\n###########Decryption Successful ##############\n\n");
	}
	else
		printf("\n###########Decryption Failed ##############\n\n");
}


void encrypt_CBC(void){
	
	uint8_t key[] = {0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c};
  	uint8_t data_block[]= {0x6b, 0xc1, 0xbe, 0xe2, 0x2e, 0x40, 0x9f, 0x96, 0xe9, 0x3d, 0x7e, 0x11, 0x73, 0x93, 0x17, 0x2a};
	uint8_t expected_op[]= {0x76, 0x49, 0xab, 0xac, 0x81, 0x19, 0xb2, 0x46, 0xce, 0xe9, 0x8e, 0x9b, 0x12, 0xe9, 0x19, 0x7d};
	uint8_t iv[]  = { 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f };
	uint8_t buf[16];
	memset(buf,0,16);
	AES_128bit_encryption_CBC(data_block,buf,key,16,iv);
	
	if (!(strncmp(expected_op,buf,16))){
		
		printf("\n###########Encryption Successful ##############\n\n");
	}
	else
		printf("\n###########Encryption Failed ##############\n\n");
	
}

void decrypt_CBC(void){
	
	uint8_t key[] = {0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c};
	uint8_t decrypt_data [] = {0x76, 0x49, 0xab, 0xac, 0x81, 0x19, 0xb2, 0x46, 0xce, 0xe9, 0x8e, 0x9b, 0x12, 0xe9, 0x19, 0x7d};
	uint8_t expected_op[]  = {0x6b, 0xc1, 0xbe, 0xe2, 0x2e, 0x40, 0x9f, 0x96, 0xe9, 0x3d, 0x7e, 0x11, 0x73, 0x93, 0x17, 0x2a};
	uint8_t iv[]  = { 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f };
	uint8_t buf_out[16];
	memset(buf_out,0,16);
	AES_128bit_decryption_CBC(decrypt_data,buf_out,key,16,iv );
	
	if (!(strncmp(expected_op,buf_out,16))){
		
		printf("\n###########Decryption Successful ##############\n\n");
	}
	else
		printf("\n###########Decryption Failed ##############\n\n");
}
